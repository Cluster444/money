<div class="page">
  <div class="page__header">
    <div class="accounts-show__title">
      <h1><%= @account.name %></h1>
      <span class="accounts-show__kind accounts-show__kind--<%= @account.kind %>"><%= @account.kind.humanize %></span>
    </div>
    <div class="accounts-show__actions">
      <%= back_button organization_accounts_path(current_organization), "Back to Accounts" %>
      <%= edit_button edit_organization_account_path(current_organization, @account) %>
    </div>
  </div>

  <div class="page__content">
    <div class="page__card">
      <div class="accounts-show__status">
        <span class="accounts-show__status-label">Status:</span>
        <span
          class="
            accounts-show__status-value <%= @account.active ? 'status-active' : 'status-inactive' %>
          "
        >
          <%= @account.active ? "Active" : "Inactive" %>
        </span>
      </div>

      <div class="accounts-show__balances">
        <div class="accounts-show__balance">
          <div class="accounts-show__balance-label"><%= @account.credit_card? ? "Amount Owed" : "Posted Balance" %></div>
          <div class="accounts-show__balance-value">
            <%= link_to number_to_currency(@account.posted_balance_for_display / 100.0), 
                        organization_account_adjustments_path(current_organization, @account), 
                        class: "accounts-show__balance-link",
                        title: "View adjustments for this account" %>
          </div>
        </div>
        <div class="accounts-show__balance">
          <div class="accounts-show__balance-label">Pending</div>
          <div class="accounts-show__balance-value"><%= number_to_currency(@account.pending_balance_for_display / 100.0) %></div>
        </div>
        <div class="accounts-show__balance">
          <div class="accounts-show__balance-label">Planned (30d)</div>
          <div class="accounts-show__balance-value"><%= number_to_currency(@account.planned_balance_for_display(Date.current + 30.days) / 100.0) %></div>
        </div>
      </div>

      <% if @account.credit_card? && (@account.next_statement_date || @account.next_due_date || @account.credit_limit) %>
        <div class="accounts-show__metadata">
          <h3>Credit Card Information</h3>
          <div class="accounts-show__metadata-grid">
            <% if @account.credit_limit %>
              <div class="accounts-show__metadata-item">
                <span class="accounts-show__metadata-key">Credit Limit:</span>
                <span class="accounts-show__metadata-value"><%= number_to_currency(@account.credit_limit / 100.0) %></span>
              </div>
            <% end %>
            <% if @account.next_statement_date %>
              <div class="accounts-show__metadata-item">
                <span class="accounts-show__metadata-key">Next Statement:</span>
                <span class="accounts-show__metadata-value"><%= @account.next_statement_date.strftime("%B %d, %Y") %></span>
              </div>
            <% end %>
            <% if @account.next_due_date %>
              <div class="accounts-show__metadata-item">
                <span class="accounts-show__metadata-key">Next Due Date:</span>
                <span class="accounts-show__metadata-value"><%= @account.next_due_date.strftime("%B %d, %Y") %></span>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

      <% if @account.metadata.present? && @account.metadata != {} && !@account.credit_card? %>
        <div class="accounts-show__metadata">
          <h3>Additional Information</h3>
          <div class="accounts-show__metadata-grid">
            <% @account.metadata.each do |key, value| %>
              <div class="accounts-show__metadata-item">
                <span class="accounts-show__metadata-key"><%= key.humanize %>:</span>
                <span class="accounts-show__metadata-value"><%= value %></span>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <% if @debit_schedules.any? %>
      <div class="page__card">
        <h2>Debit Schedules</h2>
        <div class="page__list">
          <% @debit_schedules.each do |schedule| %>
            <div class="accounts-show__schedule-card">
              <div class="accounts-show__schedule-header">
                <h3 class="accounts-show__schedule-name"><%= schedule.name %></h3>
                <% if schedule.amount.present? && schedule.period.present? %>
                  <span class="accounts-show__schedule-amount-frequency">
                    <% if schedule.frequency > 1 %>
                      <%= number_to_currency(schedule.amount / 100.0) %>/<%= schedule.frequency %> <%= schedule.period.humanize.pluralize(schedule.frequency) %>
                    <% else %>
                      <%= number_to_currency(schedule.amount / 100.0) %>/<%= schedule.period.humanize %>
                    <% end %>
                  </span>
                <% end %>
              </div>
              <div class="accounts-show__schedule-details">
                <div class="accounts-show__schedule-row">
                  <div>
                    <div class="accounts-show__schedule-detail">
                      <span class="accounts-show__schedule-label">From:</span>
                      <span class="accounts-show__schedule-value"><%= schedule.credit_account.name %></span>
                    </div>
                  </div>
                  <div class="accounts-show__schedule-dates">
                    <% if schedule.last_materialized_on.present? %>
                      <div class="accounts-show__schedule-detail">
                        <span class="accounts-show__schedule-label">Last:</span>
                        <span class="accounts-show__schedule-value"><%= schedule.last_materialized_on.strftime("%b %-d") %></span>
                      </div>
                    <% end %>
                    <% if schedule.next_materialized_on.present? %>
                      <div class="accounts-show__schedule-detail">
                        <span class="accounts-show__schedule-label">Next:</span>
                        <span class="accounts-show__schedule-value"><%= schedule.next_materialized_on.strftime("%b %-d") %></span>
                      </div>
                    <% end %>
                  </div>
                </div>
                <% if schedule.ends_on.present? %>
                  <div class="accounts-show__schedule-detail">
                    <span class="accounts-show__schedule-label">Ends:</span>
                    <span class="accounts-show__schedule-value"><%= schedule.ends_on.strftime("%B %d, %Y") %></span>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <% if @credit_schedules.any? %>
      <div class="page__card">
        <h2>Credit Schedules</h2>
        <div class="page__list">
          <% @credit_schedules.each do |schedule| %>
            <div class="accounts-show__schedule-card">
              <div class="accounts-show__schedule-header">
                <h3 class="accounts-show__schedule-name"><%= schedule.name %></h3>
                <% if schedule.amount.present? && schedule.period.present? %>
                  <span class="accounts-show__schedule-amount-frequency">
                    <% if schedule.frequency > 1 %>
                      <%= number_to_currency(schedule.amount / 100.0) %>/<%= schedule.frequency %> <%= schedule.period.humanize.pluralize(schedule.frequency) %>
                    <% else %>
                      <%= number_to_currency(schedule.amount / 100.0) %>/<%= schedule.period.humanize %>
                    <% end %>
                  </span>
                <% end %>
              </div>
              <div class="accounts-show__schedule-details">
                <div class="accounts-show__schedule-row">
                  <div>
                    <div class="accounts-show__schedule-detail">
                      <span class="accounts-show__schedule-label">To:</span>
                      <span class="accounts-show__schedule-value"><%= schedule.debit_account.name %></span>
                    </div>
                  </div>
                  <div class="accounts-show__schedule-dates">
                    <% if schedule.last_materialized_on.present? %>
                      <div class="accounts-show__schedule-detail">
                        <span class="accounts-show__schedule-label">Last:</span>
                        <span class="accounts-show__schedule-value"><%= schedule.last_materialized_on.strftime("%b %-d") %></span>
                      </div>
                    <% end %>
                    <% if schedule.next_materialized_on.present? %>
                      <div class="accounts-show__schedule-detail">
                        <span class="accounts-show__schedule-label">Next:</span>
                        <span class="accounts-show__schedule-value"><%= schedule.next_materialized_on.strftime("%b %-d") %></span>
                      </div>
                    <% end %>
                  </div>
                </div>
                <% if schedule.ends_on.present? %>
                  <div class="accounts-show__schedule-detail">
                    <span class="accounts-show__schedule-label">Ends:</span>
                    <span class="accounts-show__schedule-value"><%= schedule.ends_on.strftime("%B %d, %Y") %></span>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>

