<div class="page">
  <div class="page__header">
    <div class="accounts-show__title">
      <h1><%= @account.name %></h1>
      <span
        class="
          accounts-show__kind accounts-show__kind--<%= @account.kind_short %>
        "
      ><%= @account.kind_short.humanize %></span>
    </div>
    <div class="accounts-show__actions">
      <%= back_button organization_accounts_path(current_organization), "Back to Accounts" %>
      <%= edit_button edit_organization_account_path(current_organization, @account) %>
    </div>
  </div>

  <div class="page__content">
    <div class="page__card">
      <div class="accounts-show__status">
        <span class="accounts-show__status-label">Status:</span>
        <span
          class="
            accounts-show__status-value <%= @account.active ? 'status-active' : 'status-inactive' %>
          "
        >
          <%= @account.active ? "Active" : "Inactive" %>
        </span>
      </div>

      <div class="accounts-show__balances">
        <div class="accounts-show__balance">
          <div class="accounts-show__balance-label"><%= @account.credit_card? ? "Amount Owed" : "Posted Balance" %></div>
          <div class="accounts-show__balance-value">
            <%= link_to number_to_currency(@account.posted_balance_for_display),
            organization_account_adjustments_path(current_organization, @account),
            class: "accounts-show__balance-link",
            title: "View adjustments for this account" %>
          </div>
        </div>
        <div class="accounts-show__balance">
          <div class="accounts-show__balance-label">Pending</div>
          <div class="accounts-show__balance-value"><%= number_to_currency(@account.pending_balance_for_display) %></div>
        </div>
        <div class="accounts-show__balance">
          <div class="accounts-show__balance-label">Planned (30d)</div>
          <div class="accounts-show__balance-value"><%= number_to_currency(@account.planned_balance_for_display(Date.current + 30.days)) %></div>
        </div>
      </div>

      <% if @account.credit_card? %>
        <div class="accounts-show__metadata">
          <h3>Credit Card Information</h3>
          <div class="accounts-show__metadata-grid">
            <div class="accounts-show__metadata-item">
              <span class="accounts-show__metadata-key">Credit Limit:</span>
              <span class="accounts-show__metadata-value"><%= number_to_currency(@account.credit_limit, precision: 0) %></span>
            </div>
            <div class="accounts-show__metadata-item">
              <span class="accounts-show__metadata-key">Next Statement:</span>
              <span class="accounts-show__metadata-value"><%= @account.next_statement_date.strftime("%B %d, %Y") %></span>
            </div>
            <div class="accounts-show__metadata-item">
              <span class="accounts-show__metadata-key">Next Due Date:</span>
              <span class="accounts-show__metadata-value"><%= @account.next_due_date.strftime("%B %d, %Y") %></span>
            </div>
          </div>
        </div>
      <% end %>

      <% if @account.metadata.present? && @account.metadata != {} && !@account.credit_card? %>
        <div class="accounts-show__metadata">
          <h3>Additional Information</h3>
          <div class="accounts-show__metadata-grid">
            <% @account.metadata.each do |key, value| %>
              <div class="accounts-show__metadata-item">
                <span class="accounts-show__metadata-key"><%= key.humanize %>:</span>
                <span class="accounts-show__metadata-value"><%= value %></span>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <% if @debit_schedules.any? %>
      <div class="page__card">
        <h2>Debit Schedules</h2>
        <div class="page__list">
          <% @debit_schedules.each do |schedule| %>
            <div class="accounts-show__schedule-card">
              <div class="accounts-show__schedule-header">
                <h3 class="accounts-show__schedule-name"><%= schedule.name %></h3>
                <% if schedule.amount.present? && schedule.period.present? %>
                  <span class="accounts-show__schedule-amount-frequency">
                    <% if schedule.frequency > 1 %>
                      <%= number_to_currency(schedule.amount) %>/<%= schedule.frequency %>
                      <%= schedule.period.humanize.pluralize(schedule.frequency) %>
                    <% else %>
                      <%= number_to_currency(schedule.amount) %>/<%= schedule.period.humanize %>
                    <% end %>
                  </span>
                <% end %>
              </div>
              <div class="accounts-show__schedule-details">
                <div class="accounts-show__schedule-row">
                  <div>
                    <div class="accounts-show__schedule-detail">
                      <span class="accounts-show__schedule-label">From:</span>
                      <span class="accounts-show__schedule-value"><%= schedule.credit_account.name %></span>
                    </div>
                  </div>
                  <div class="accounts-show__schedule-dates">
                    <% if schedule.last_materialized_on.present? %>
                      <div class="accounts-show__schedule-detail">
                        <span class="accounts-show__schedule-label">Last:</span>
                        <span class="accounts-show__schedule-value"><%= schedule.last_materialized_on.strftime("%b %-d") %></span>
                      </div>
                    <% end %>
                    <% if schedule.next_materialized_on.present? %>
                      <div class="accounts-show__schedule-detail">
                        <span class="accounts-show__schedule-label">Next:</span>
                        <span class="accounts-show__schedule-value"><%= schedule.next_materialized_on.strftime("%b %-d") %></span>
                      </div>
                    <% end %>
                  </div>
                </div>
                <% if schedule.ends_on.present? %>
                  <div class="accounts-show__schedule-detail">
                    <span class="accounts-show__schedule-label">Ends:</span>
                    <span class="accounts-show__schedule-value"><%= schedule.ends_on.strftime("%B %d, %Y") %></span>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <% if @credit_schedules.any? %>
      <div class="page__card">
        <h2>Credit Schedules</h2>
        <div class="page__list">
          <% @credit_schedules.each do |schedule| %>
            <div class="accounts-show__schedule-card">
              <div class="accounts-show__schedule-header">
                <h3 class="accounts-show__schedule-name"><%= schedule.name %></h3>
                <% if schedule.amount.present? && schedule.period.present? %>
                  <span class="accounts-show__schedule-amount-frequency">
                    <% if schedule.frequency > 1 %>
                      <%= number_to_currency(schedule.amount) %>/<%= schedule.frequency %>
                      <%= schedule.period.humanize.pluralize(schedule.frequency) %>
                    <% else %>
                      <%= number_to_currency(schedule.amount) %>/<%= schedule.period.humanize %>
                    <% end %>
                  </span>
                <% end %>
              </div>
              <div class="accounts-show__schedule-details">
                <div class="accounts-show__schedule-row">
                  <div>
                    <div class="accounts-show__schedule-detail">
                      <span class="accounts-show__schedule-label">To:</span>
                      <span class="accounts-show__schedule-value"><%= schedule.debit_account.name %></span>
                    </div>
                  </div>
                  <div class="accounts-show__schedule-dates">
                    <% if schedule.last_materialized_on.present? %>
                      <div class="accounts-show__schedule-detail">
                        <span class="accounts-show__schedule-label">Last:</span>
                        <span class="accounts-show__schedule-value"><%= schedule.last_materialized_on.strftime("%b %-d") %></span>
                      </div>
                    <% end %>
                    <% if schedule.next_materialized_on.present? %>
                      <div class="accounts-show__schedule-detail">
                        <span class="accounts-show__schedule-label">Next:</span>
                        <span class="accounts-show__schedule-value"><%= schedule.next_materialized_on.strftime("%b %-d") %></span>
                      </div>
                    <% end %>
                  </div>
                </div>
                <% if schedule.ends_on.present? %>
                  <div class="accounts-show__schedule-detail">
                    <span class="accounts-show__schedule-label">Ends:</span>
                    <span class="accounts-show__schedule-value"><%= schedule.ends_on.strftime("%B %d, %Y") %></span>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <% if @transfers.any? %>
      <div class="page__card">
        <h2>Transfers</h2>
        <div class="page__list">
          <% @transfers.each do |transfer| %>
            <div class="accounts-show__transfer-card">
              <div class="accounts-show__transfer-header">
                <div class="accounts-show__transfer-amount">
                  <%= number_to_currency(transfer.amount) %>
                </div>
                <div class="accounts-show__transfer-status <%= transfer.state %>">
                  <%= transfer.state.humanize %>
                </div>
              </div>
              <div class="accounts-show__transfer-details">
                <div class="accounts-show__transfer-accounts">
                  <% if transfer.debit_account == @account %>
                    <span class="accounts-show__transfer-direction">From:</span>
                    <span class="accounts-show__transfer-account"><%= transfer.credit_account.name %></span>
                  <% else %>
                    <span class="accounts-show__transfer-direction">To:</span>
                    <span class="accounts-show__transfer-account"><%= transfer.debit_account.name %></span>
                  <% end %>
                </div>
                <div class="accounts-show__transfer-dates">
                  <div class="accounts-show__transfer-date">
                    <span class="accounts-show__transfer-date-label">
                      <%= transfer.pending? ? "Pending:" : "Posted:" %>
                    </span>
                    <span class="accounts-show__transfer-date-value">
                      <%= (transfer.pending? ? transfer.pending_on : transfer.posted_on).strftime("%b %-d, %Y") %>
                    </span>
                  </div>
                  <% if transfer.schedule.present? %>
                    <div class="accounts-show__transfer-schedule">
                      <span class="accounts-show__transfer-schedule-label">Schedule:</span>
                      <span class="accounts-show__transfer-schedule-name"><%= transfer.schedule.name %></span>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>
