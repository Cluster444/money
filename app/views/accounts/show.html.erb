<div class="page">
  <div class="page__header">
    <div class="accounts-show__title">
      <h1><%= @account.name %></h1>
      <span
        class="
          accounts-show__kind accounts-show__kind--<%= @account.kind_short %>
        "
      ><%= @account.kind_short.humanize %></span>
    </div>
    <div class="accounts-show__actions">
      <%= back_button organization_accounts_path(current_organization), "Back to Accounts" %>
      <%= edit_button edit_organization_account_path(current_organization, @account) %>
    </div>
  </div>

  <div class="page__content">
    <div class="page__card">
      <div class="accounts-show__status">
        <span class="accounts-show__status-label">Status:</span>
        <span
          class="
            accounts-show__status-value <%= @account.active ? 'status-active' : 'status-inactive' %>
          "
        >
          <%= @account.active ? "Active" : "Inactive" %>
        </span>
      </div>

      <div class="accounts-show__balances">
        <div class="accounts-show__balance">
          <div class="accounts-show__balance-label"><%= @account.credit_card? ? "Amount Owed" : "Posted Balance" %></div>
          <div class="accounts-show__balance-value">
            <%= link_to number_to_currency(@account.posted_balance_for_display),
            organization_account_adjustments_path(current_organization, @account),
            class: "accounts-show__balance-link",
            title: "View adjustments for this account" %>
          </div>
        </div>
        <div class="accounts-show__balance">
          <div class="accounts-show__balance-label">Pending</div>
          <div class="accounts-show__balance-value"><%= number_to_currency(@account.pending_balance_for_display) %></div>
        </div>
        <div class="accounts-show__balance">
          <div class="accounts-show__balance-label">Planned (30d)</div>
          <div class="accounts-show__balance-value"><%= number_to_currency(@account.planned_balance_for_display(Date.current + 30.days)) %></div>
        </div>
      </div>

      <% if @account.credit_card? %>
        <div class="accounts-show__metadata">
          <h3>Credit Card Information</h3>
          <div class="accounts-show__metadata-grid">
            <div class="accounts-show__metadata-item">
              <span class="accounts-show__metadata-key">Credit Limit:</span>
              <span class="accounts-show__metadata-value"><%= number_to_currency(@account.credit_limit, precision: 0) %></span>
            </div>
            <div class="accounts-show__metadata-item">
              <span class="accounts-show__metadata-key">Next Statement:</span>
              <span class="accounts-show__metadata-value"><%= @account.next_statement_date.strftime("%B %d, %Y") %></span>
            </div>
            <div class="accounts-show__metadata-item">
              <span class="accounts-show__metadata-key">Next Due Date:</span>
              <span class="accounts-show__metadata-value"><%= @account.next_due_date.strftime("%B %d, %Y") %></span>
            </div>
          </div>
        </div>
      <% end %>

      <% if @account.metadata.present? && @account.metadata != {} && !@account.credit_card? %>
        <div class="accounts-show__metadata">
          <h3>Additional Information</h3>
          <div class="accounts-show__metadata-grid">
            <% @account.metadata.each do |key, value| %>
              <div class="accounts-show__metadata-item">
                <span class="accounts-show__metadata-key"><%= key.humanize %>:</span>
                <span class="accounts-show__metadata-value"><%= value %></span>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <%= render Components::TabPanel.new() do |tabs| %>
      <%= tabs.tab("Debits") do %>
        <%= render("schedules", schedules: @debit_schedules) if @debit_schedules %>
      <% end %>
      <%= tabs.tab("Credits") do %>
        <%= render("schedules", schedules: @credit_schedules) if @credit_schedules %>
      <% end %>
      <%= tabs.tab("Transfers") do %>
        <%= render("transfers") if @transfers %>
      <% end %>
    <% end %>
  </div>
</div>

